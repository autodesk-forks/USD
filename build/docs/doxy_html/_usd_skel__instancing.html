<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: Instancing in UsdSkel</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_usd_skel__instancing.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Instancing in UsdSkel </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="UsdSkel_Instancing_BindState"></a>
Instancing the "Bind State"</h1>
<p>A critical component of scalability when attempting to encode a crowd is that a model's <code>Bind State</code> must be <em>instanced</em> across similar models. For example, suppose that a crowd has multiple copies of a particular model: Each of those copies will typically have a different root transform, and different set of joint transforms. Visually, the skinned models may all look entirely unique, but most of the contents of each copy of that model is identical: The topology of each geometric primitive within the model is the same. The primvars within the model are the same. The only properties that are not changed when skinning a copy of the model are <em>points</em> and <em>normals</em> of the skinned geometry.</p>
<p>Scalability when encoding many such copies of characters depends on ensuring that those properties of each character that can be shared, are shared. So what is really meant when talking about <em>instancing</em> in UsdSkel is this notion of instancing the <em>bind state</em> of a skeletally posed model. It is important that that level of instancing can be encoded in USD.</p>
<p>UsdSkel encodes this concept using a combination of inherited properties and <a href="https://openusd.org/release/glossary.html#usdglossary-instancing">scene graph instancing</a>.</p>
<h2><a class="anchor" id="UsdSkel_Instancing_Example"></a>
Instancing Example</h2>
<p>This section contains a simple example of <em>bind state instancing</em>. We will begin with the complete example, before breaking it into parts:</p>
<div class="fragment"><div class="line">def Xform <span class="stringliteral">&quot;Model&quot;</span> (</div><div class="line">    instanceable = <span class="keyword">true</span></div><div class="line">    prepend apiSchemas = [<span class="stringliteral">&quot;SkelBindingAPI&quot;</span>]</div><div class="line">)</div><div class="line">{</div><div class="line">    rel skel:skeleton = &lt;Skel&gt;</div><div class="line">    </div><div class="line">    def Mesh <span class="stringliteral">&quot;Mesh&quot;</span> {}</div><div class="line"></div><div class="line">    def Skeleton <span class="stringliteral">&quot;Skel&quot;</span> {}</div><div class="line">}</div><div class="line"></div><div class="line">def SkelAnimation <span class="stringliteral">&quot;ModelAnim_1&quot;</span> {}</div><div class="line">...</div><div class="line">def SkelAnimation <span class="stringliteral">&quot;ModelAnim_N&quot;</span> {}</div><div class="line"></div><div class="line">over Model_1 (</div><div class="line">    add references = &lt;/Model&gt;</div><div class="line">)</div><div class="line">{</div><div class="line">    rel skel:animationSource = &lt;/ModelAnim_1&gt;</div><div class="line">}</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">over Model_N (</div><div class="line">    add references = &lt;/Model&gt;</div><div class="line">)</div><div class="line">{</div><div class="line">    rel skel:animationSource = &lt;/ModelAnim_N&gt;</div><div class="line">}</div></div><!-- fragment --><p>This example begins with the definition of an instanceable model, which contains a Skeleton:</p>
<div class="fragment"><div class="line">def Xform <span class="stringliteral">&quot;Model&quot;</span> (</div><div class="line">    instanceable = <span class="keyword">true</span></div><div class="line">    prepend apiSchemas = [<span class="stringliteral">&quot;SkelBindingAPI&quot;</span>]</div><div class="line">)</div><div class="line">{</div><div class="line">    rel skel:skeleton = &lt;Skel&gt;</div><div class="line">    </div><div class="line">    def Mesh <span class="stringliteral">&quot;Mesh&quot;</span> {}</div><div class="line"></div><div class="line">    def Skeleton <span class="stringliteral">&quot;Skel&quot;</span> {}</div><div class="line">}</div></div><!-- fragment --><p>Typically, the <code>&lt;/Model&gt;</code> primitive would be defined in a separate file, and the reference that is added at each model instance would target that file.</p>
<p>Since this model has <code>instanceable</code> to <code>true</code>, when another primitive is created that references <code>&lt;/Model&gt;</code>, USD will <em>instance</em> the scene graph beneath the model.</p>
<p>The contents of <code>&lt;/Model&gt;</code> consist of a mesh (often <em>many</em> meshes), which has been bound to a Skeleton. This encapsulates the entire <em>bind state</em> of the model as an instanced scene graph location.</p>
<div class="fragment"><div class="line">def SkelAnimation <span class="stringliteral">&quot;ModelAnim_1&quot;</span> {}</div><div class="line">...</div><div class="line">def SkelAnimation <span class="stringliteral">&quot;ModelAnim_N&quot;</span> {}</div></div><!-- fragment --><p>Here, we encode unique joint animations, so that we can bind them to the copies of <code>&lt;/Model&gt;</code> that will follow.</p>
<p>Note that when a scene graph location is instanced in USD, it is not possible to add additional primitives beneath that scene graph location.</p>
<p>So we cannot add the SkelAnimation primitives as children of each copy of <code>&lt;/Model&gt;</code>.</p>
<p>Having defined unique animations, we then proceed to make copies of <code>&lt;/Model&gt;</code>:</p>
<div class="fragment"><div class="line">over Model_1 (</div><div class="line">    add references = &lt;/Model&gt;</div><div class="line">)</div><div class="line">{</div><div class="line">    rel skel:animationSource = &lt;/ModelAnim_1&gt;</div><div class="line">}</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">over Model_N (</div><div class="line">    add references = &lt;/Model&gt;</div><div class="line">)</div><div class="line">{</div><div class="line">    rel skel:animationSource = &lt;/ModelAnim_N&gt;</div><div class="line">}</div></div><!-- fragment --><p>As discussed in other sections, such as the <a class="el" href="_usd_skel__schema_overview.html#UsdSkel_SchemaOverview_SkelAnimations">skel animation overview</a>, the <em>skel:animationSource</em> relationship is "inherited" down namespace, onto Skeleton primitives. This inheritance property passes down into instances as well. So each instanced Skeleton beneath our <code>&lt;/Model_1&gt;, ... &lt;/Model_N&gt;</code> instances adopts the SkelAnimation that has been assigned on the instance itself.</p>
<p>Note that this ability to specify overrides on an instance is not unique to UsdSkel: Primvars in USD work the same way.</p>
<p>The net result of this encoding: The entire bind state of <code>&lt;/Model&gt;</code> has been instanced to different scene graph locations, each of which has specified a unique SkelAnimation to apply to the underlying Skeleton(s). </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="usd_skel_page_front.html">UsdSkel : USD Skeleton Schema and API</a></li>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:06:57 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>