<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: Pcp : PrimCache Population (Composition)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('pcp_page_front.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Pcp : PrimCache Population (Composition) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="pcp_Intro"></a>
Introduction</h1>
<p>Pcp implements the core scenegraph composition semantics &mdash; the behavior informally referred to as <em>Layering &amp; Referencing</em>.</p>
<p>Pcp specializes in providing low-level composition services on behalf of higher-level scenegraph libraries (Usd, Csd, Mf) that instantiate scenegraph objects based on the results. Most clients will typically use one of those libraries, rather than consulting Pcp directly. The name "Pcp" stands for <em>Prim Cache Population</em>, a historical term for this area of the system.</p>
<h1><a class="anchor" id="pcp_Motivation"></a>
Motivation</h1>
<p>Objects in the scenegraph are backed by scene description &ndash; authored data describing those objects.</p>
<p>A single file of scene description is sufficient to describe a hierarchy of objects. However, it is also useful to organize that data across multiple files. For one thing, this provides a way for multiple people (such as in different departments) to collaborate while keeping their contributions distinct. For another, this provides a means of re-use: an asset like a rig or model can be built once, then used many times as needed.</p>
<p>This instancing is expressed as a "reference arc" that points at the external file. The Pcp runtime detects and interprets these arcs to bring together the disparate files into a single combined set of opinions. By using a reference arc, the underlying external asset can be continually worked on, with improvements automatically being picked up in downstream assets.</p>
<p>There are other kinds of arcs that provide variations of this behavior. Pcp provides the service of identifying and interpreting these composition arcs.</p>
<h1><a class="anchor" id="pcp_Capabilities"></a>
Capabilities</h1>
<p>Pcp implements the following composition semantics:</p>
<ul>
<li>sublayers </li>
<li>list-editing </li>
<li>references </li>
<li>payloads </li>
<li>inherits / classes </li>
<li>variants </li>
<li>"standin" variant preferences </li>
<li>relocates </li>
<li>permissions</li>
</ul>
<p>In support of this, the runtime provides these features:</p>
<ul>
<li>caching and cache invalidation </li>
<li>change processing </li>
<li>dependency tracking </li>
<li>namespace editing support </li>
<li>path translation </li>
<li>error detection </li>
<li>payload inclusion control </li>
<li>diagnostic output</li>
</ul>
<p>Pcp is all about finding sources of opinions that contribute to objects. It has little to do with the interpretation of those opinions. As a result, there are some higher-level features which are sometimes thought of as part of composition, but which are not part of Pcp:</p>
<ul>
<li>model hierarchy </li>
<li>scenegraph structure, objects and their identity </li>
<li>value resolution </li>
<li>symmetry</li>
</ul>
<h1><a class="anchor" id="pcp_Usage"></a>
Usage</h1>
<h2><a class="anchor" id="pcp_PcpCache"></a>
The PcpCache</h2>
<p>The main entrypoint to the Pcp algorithm is the <a class="el" href="class_pcp_cache.html" title="PcpCache is the context required to make requests of the Pcp composition algorithm and cache the resu...">PcpCache</a>. It provides a context to specify the key parameters that configure how composition should be performed. It also provides storage for caching the results of composition queries.</p>
<p>The input parameters to the composition algorithm are:</p>
<ul>
<li>a root layer </li>
<li>a session layer (optional) </li>
<li>a path resolver context </li>
<li>standin preferences (ex: render, anim, etc.) </li>
<li>payload inclusion set &ndash; paths for which payloads should be included</li>
</ul>
<p>Most of these are fixed when a <a class="el" href="class_pcp_cache.html" title="PcpCache is the context required to make requests of the Pcp composition algorithm and cache the resu...">PcpCache</a> is created. The payload inclusion set can be modified at runtime to bring payloads into and out of the working set.</p>
<h2><a class="anchor" id="pcp_Queries"></a>
Computation Queries</h2>
<p>Once a cache has been created, it can service composition queries. These apply composition algorithms to the underlying scene description data. See the ComputeXXX methods on <a class="el" href="class_pcp_cache.html" title="PcpCache is the context required to make requests of the Pcp composition algorithm and cache the resu...">PcpCache</a>. The most fundamental queries are <a class="el" href="class_pcp_cache.html#a316a2ebde2a1f18e3ffd14c3c6e662d8" title="Returns the layer stack for identifier if it exists, otherwise creates a new layer stack for identifi...">PcpCache::ComputeLayerStack()</a> and <a class="el" href="class_pcp_cache.html#a65e7a19d2c33d5dd2de28423299b85ae" title="Compute and return a reference to the cached result for the prim index for the given path.">PcpCache::ComputePrimIndex()</a>. These two provide the majority of the composition semantics and are the basis for the other queries. Different queries return different types of result values.</p>
<h2><a class="anchor" id="pcp_Errors"></a>
Errors</h2>
<p>The process of composition may discover errors in the structure of the scene. For example, a reference arc might target a file that cannot be found (resolved), or it might create a reference cycle.</p>
<p>These errors get first-class treatment in Pcp. That is, errors are not a side-effect; they are treated as a formal output of the composition algorithms and returned alongside the primary results describing the structure of the scene. Pcp does not embed any error handling or reporting policy. It is entirely up to Pcp clients to dispatch errors.</p>
<dl class="section note"><dt>Note</dt><dd>Pcp <b>does</b> participate in the <a class="el" href="class_tf_error.html" title="Represents an object that contains error information.">TfError</a> reporting system when it encounters API misuse (coding errors), as do the lower-level modules it uses. Pcp only treats errors in authored scene description specially.</dd></dl>
<p>Errors are represented as instances of a <a class="el" href="class_pcp_error_base.html" title="Base class for all error types.">PcpErrorBase</a> base class. Each error sub-type contains semantic information about the source and exact details of the error, as would be required to report the error to the user, check if the error still applies, or programmatically address it.</p>
<p>Each Pcp computation stores a "local" set of errors that are specific to that computation. If one computation requires recursive computation &ndash; such as one prim needing to compute a layer stack across a reference arc &ndash; the errors for the nested computation will be stored locally with that nested computation. Each Pcp result provides a GetLocalErrors() API to examine its local errors. Since errors are first-class results of Pcp and stored as part of the primary composition outputs, they are cached along with those outputs.</p>
<p>Clients of Pcp typically want to report errors when they are first discovered. They want to do this without needing knowledge about the cache hit/miss behavior or the recursive nature of composition queries. To facilitate this common usage, Pcp API provides an "allErrors" output argument that will accumulate any newly discovered errors. In the case of cache hits, existing errors will not be reported.</p>
<p>For simple cases where you just want to raise Pcp errors as Tf runtime errors, see PcpRaiseErrors().</p>
<h2><a class="anchor" id="pcp_Dependencies"></a>
Dependencies</h2>
<p>In addition to the primary result and errors, computations also internally retain the dependencies discovered by a cached computation result. For example, computing a <a class="el" href="class_pcp_prim_index.html" title="PcpPrimIndex is an index of the all sites of scene description that contribute opinions to a specific...">PcpPrimIndex</a> that contains a reference will internally record a dependency representing that reference. This dependency internally retains the scene description layer across the reference. Dependencies also provide a means to analyze and propagate changes to the scene, as well as to implement namespace editing (rename, reparent, and delete operations), which want to fix up dependent scene opinions accordingly. <a class="el" href="class_pcp_cache.html" title="PcpCache is the context required to make requests of the Pcp composition algorithm and cache the resu...">PcpCache</a> has API to query dependencies; for example, see PcpCache::GetPathsUsingSite().</p>
<h2><a class="anchor" id="pcp_NamespaceEditing"></a>
Namespace Editing</h2>
<p>The phrase "namespace editing" means operations that edit namespace: renaming, reparenting, or removing composed objects. Although Pcp does not maintain a scenegraph of composed objects, it does provide utilities for such a library to implement these operations, making use of the Pcp dependencies to build a list of necessary edits to the underlying layers that keep them consistent with one another. See PcpCache::ComputeNamespaceEdits().</p>
<h2><a class="anchor" id="pcp_ChangeProcessing"></a>
Change Processing</h2>
<p>Pcp caches computation results derived from the underlying scene description data. When that underlying data changes, those computations are no longer valid. Pcp provides assistance to determine which computations have been invalidated, and to re-compute them as desired. <a class="el" href="class_pcp_changes.html" title="Describes Pcp changes.">PcpChanges</a> represents the effect that a set of changes to scene description have on a <a class="el" href="class_pcp_cache.html" title="PcpCache is the context required to make requests of the Pcp composition algorithm and cache the resu...">PcpCache</a>. Processing changes has two phases: the first is to build up the list of changes, (including chasing dependencies to find all the affected caches); the second is to apply those changes, invalidating the internal caches. It is up to the client to re-pull on any affected caches. Since dependencies are dropped when the cached computations that yielded them are invalidated, <a class="el" href="class_pcp_lifeboat.html" title="Structure used to temporarily retain layers and layerStacks within a code block.">PcpLifeboat</a> provides a way to retain the underlying referenced data for the duration of time until the client can re-pull on the cached computations.</p>
<p>Every <a class="el" href="class_pcp_changes.html" title="Describes Pcp changes.">PcpChanges</a> object requested by a scenegraph client contains a <a class="el" href="class_pcp_lifeboat.html" title="Structure used to temporarily retain layers and layerStacks within a code block.">PcpLifeboat</a>, so clients should rarely need to interact with one directly.</p>
<h2><a class="anchor" id="pcp_PathTranslation"></a>
Path Translation</h2>
<p>Composition arcs pull together scene description from different places in layers. Part of this process requires rebinding those opinions to new paths. For example, a model at the path <code> &lt;/World/anim/chars/MeridaGroup/Merida&gt; </code> may reference a model at the source path <code> &lt;/Merida&gt; </code>. Now imagine a relationship authored within <code> &lt;/Merida/rig/FaceRig&gt; </code> to <code> &lt;/Merida/anim/Face&gt;. </code> To resolve that relationship path, composition needs to transform the authored values flowing across the arc so that they re-bind to the new namespace position of Merida, in <code> &lt;/World/anim/chars/MeridaGroup/Merida/anim/Face&gt; </code>. This process is known as "path translation", and is one of the more subtle and important behaviors of Pcp. See <a class="el" href="path_translation_8h.html#aac0d3b0296eb726e76d81fdd4e69b2b7" title="Translates pathInNodeNamespace from the namespace of the prim index node sourceNode to the namespace ...">PcpTranslatePathFromNodeToRoot()</a> and <a class="el" href="path_translation_8h.html#a7ac9fcfa3b15058379f75daf75fda373" title="Translates pathInRootNamespace from the namespace of the root of the prim index that destNode belongs...">PcpTranslatePathFromRootToNode()</a>.</p>
<h2><a class="anchor" id="pcp_Diagnostics"></a>
Diagnostics</h2>
<p>Composition is a large subsystem and have can have complicated results. To help analyze the system we provide a few features:</p>
<ul>
<li><a class="el" href="class_pcp_prim_index.html#a04007d783df319a8101b20e99bbdddd5" title="Dump the prim index contents to a string.">PcpPrimIndex::DumpToString()</a> - to dump out a prim's structure </li>
<li><a class="el" href="class_pcp_prim_index.html#ae930cda55ec639abd1e9e723553b9a0d" title="Prints various statistics about this prim index.">PcpPrimIndex::PrintStatistics()</a> - to analyze a prim's structure </li>
<li><a class="el" href="class_pcp_cache.html#ae930cda55ec639abd1e9e723553b9a0d" title="Prints various statistics about the data stored in this cache.">PcpCache::PrintStatistics()</a> - to analyze a cache's overall footprint </li>
<li>TF_DEBUG runtime debugging flags &ndash; see pcp/debugCodes.h </li>
<li>Optional additional runtime validation that must be compiled in: <code>PCP_DIAGNOSTIC_VALIDATION</code> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:06:57 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>