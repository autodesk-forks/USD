<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: The TfNotice Notification System</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('page_tf__notification.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The <a class="el" href="class_tf_notice.html" title="The base class for objects used to notify interested parties (listeners) when events have occurred.">TfNotice</a> Notification System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_tf_Notification_Contents"></a>
Contents</h1>
<ul>
<li><a class="el" href="page_tf__notification.html#sec_tf_Notification_Overview">Overview</a> </li>
<li><a class="el" href="page_tf__notification.html#sec_tf_Notification_NotificationClasses">Notification Classes</a> </li>
<li><a class="el" href="page_tf__notification.html#sec_tf_Notification_DeliveryMechanism">Delivery Mechanism</a> </li>
<li><a class="el" href="page_tf__notification.html#sec_tf_Notification_SimpleExample">Simple Example</a> </li>
<li><a class="el" href="page_tf__notification.html#sec_tf_Notification_ThreadSafety">Thread Safety</a></li>
</ul>
<h1><a class="anchor" id="sec_tf_Notification_Overview"></a>
Overview</h1>
<p>The notification subsystem notifies interested objects that some important event has occurred somewhere in the application. Notices can be thought of as anonymous function calls. They are function calls in the sense that they are synchronous and efficient; they are anonymous in the sense that senders aren't aware of listeners (although listeners can choose to be aware of senders if they wish).</p>
<p>A common use of notification is for a model to notify a view that the model has changed and the view needs to be updated. (The terms model and view are used here as in the Model-View-Controller paradigm). For example, a cue sheet might send a cue-changed notification to inform an mdt-like spread sheet view to update itself. Notifications are synchronous broadcasts. The sender doesn't know who is interested in the notification and there can be many listeners for each notification. Another use of notification is in the Tf error handling mechanism. See <a class="el" href="class_tf_error.html" title="Represents an object that contains error information.">TfError</a> for more details.</p>
<h1><a class="anchor" id="sec_tf_Notification_NotificationClasses"></a>
Notification Classes</h1>
<p>The notification subsystem exports one class, named <a class="el" href="class_tf_notice.html" title="The base class for objects used to notify interested parties (listeners) when events have occurred.">TfNotice</a>. This class is used to represent the arguments to the anonymous function call. The <a class="el" href="class_tf_notice.html" title="The base class for objects used to notify interested parties (listeners) when events have occurred.">TfNotice</a> base class is the class from which all notifications are derived. Notifications are intended to encapsulate information about some event that is important to the application. Each derived notification class should provide the most specific information possible that describes the event. For example, a cue-changed notification class should contain a pointer to the avar that changed.</p>
<p>As the example below indicates, notices associated with changes to a model are part of the model's public interface. Accordingly, these types of notices should be designed carefully and changed infrequently.</p>
<h1><a class="anchor" id="sec_tf_Notification_DeliveryMechanism"></a>
Delivery Mechanism</h1>
<p>A sender issues a notice by constructing a new notice object (derived from the <a class="el" href="class_tf_notice.html" title="The base class for objects used to notify interested parties (listeners) when events have occurred.">TfNotice</a> class) and invoking the Send() method to have the notice delivered to all interested listeners. The notification system synchronously invokes each interested listener (in arbitrary order), then returns control to the sender. An implication of synchronicity is that the listeners are run in the sender's thread. Another implication is that listeners should be as efficient as possible to avoid unnecessary slowdowns.</p>
<h1><a class="anchor" id="sec_tf_Notification_SimpleExample"></a>
Simple Example</h1>
<p>The following code sample illustrates the use of notification where a cue-changed notice is received by a listener associated with the user interface of an interactive application. The cue library defines the CueAvarChangedNotice class in cue.h:</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>CueAvarChangedNotice : <span class="keyword">public</span> <a class="code" href="class_tf_notice.html">TfNotice</a> </div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    CueAvarChangedNotice(<span class="keyword">const</span> Cue *whichCue, <span class="keyword">const</span> std::string &amp;whichAvar);</div><div class="line">    Cue *GetCue() <span class="keyword">const</span>;</div><div class="line">    <span class="keyword">const</span> std::string GetAvar() <span class="keyword">const</span>;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    std::string _avar;</div><div class="line">    <span class="keyword">const</span> Cue *_cue;    </div><div class="line">};</div></div><!-- fragment --><p>Observe that the new notice class registers itself with the <a class="el" href="class_tf_type.html" title="TfType represents a dynamic runtime type.">TfType</a> type-system; this is required so that registration of interest in a class N results in a listener receiving notice of type N as well as notices of any type derived from N.</p>
<p>Let us say that you define a class that needs to know when the cue changes. In the following example, this class is interested in all notices, and in particular is interested in cue change notices.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>UIListener : <span class="keyword">public</span> <a class="code" href="class_tf_weak_base.html">TfWeakBase</a> </div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    UIListener() </div><div class="line">        {</div><div class="line">        <a class="code" href="class_tf_weak_ptr.html">TfWeakPtr&lt;UIListener&gt;</a> me(<span class="keyword">this</span>);</div><div class="line">        <a class="code" href="class_tf_notice.html#a68c24dba64e7a7135f62d1bdab33ca7f">TfNotice::Register</a>(me, &amp;UIListener::ProcessCueChange);</div><div class="line">        <a class="code" href="class_tf_notice.html#a68c24dba64e7a7135f62d1bdab33ca7f">TfNotice::Register</a>(me, &amp;UIListener::ProcessAllNotices);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> ProcessCueChange(<span class="keyword">const</span> CueChangeNotice &amp;n);</div><div class="line">    <span class="keywordtype">void</span> ProcessAllNotices(<span class="keyword">const</span> <a class="code" href="class_tf_notice.html">TfNotice</a> &amp;n);</div><div class="line">};</div></div><!-- fragment --><p>When this listener class is initialized, it uses the templated free function <a class="el" href="class_tf_notice.html#a68c24dba64e7a7135f62d1bdab33ca7f" title="Register a listener as being interested in a TfNotice.">TfNotice::Register</a> to register interest in any notice class derived from CueChangeNotice. When such a notice is sent, the ProcessCueChange() method should be called. In this example, <a class="el" href="class_tf_notice.html#a68c24dba64e7a7135f62d1bdab33ca7f" title="Register a listener as being interested in a TfNotice.">TfNotice::Register</a> is used a second time to indicate that the ProcessAllNotices() method should be called whenever a notice derived from <a class="el" href="class_tf_notice.html" title="The base class for objects used to notify interested parties (listeners) when events have occurred.">TfNotice</a> (that is, any kind of notice at all) is sent.</p>
<p>Note that a UIListener has no way of indicating that it no longer wishes to receive messages. If your class needs the ability to turn listening on and off, see <a class="el" href="class_tf_notice.html#ab183e05189affeabc78270a9c1be4241" title="Revoke interest by a listener.">TfNotice::Revoke()</a> for more information. However, note that it is always safe for a listener to simply be deleted without informing the <a class="el" href="class_tf_notice.html" title="The base class for objects used to notify interested parties (listeners) when events have occurred.">TfNotice</a> system (but see also <a class="el" href="page_tf__notification.html#sec_tf_Notification_ThreadSafety">Thread Safety</a> below).</p>
<p>Now that every thing is initialized you can get down to changing the cue. The cue class member function that changes the avar sends the notice as follows (in cue.cpp):</p>
<div class="fragment"><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Tell the Tf type system to instanciate the type. This</span></div><div class="line"><span class="comment">// must be done in a single .cpp file.</span></div><div class="line"><span class="comment">//</span></div><div class="line">TF_INSTANTIATE_TYPE(CueChangedNotice, </div><div class="line">                     <a class="code" href="class_tf_type.html#a3de4639f976acbf3cf416d5997939bffa4579924b160e725f1bcb8945e133bd57">TfType::CONCRETE</a>, TF_1_PARENT(<a class="code" href="class_tf_notice.html">TfNotice</a>));</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">void</div><div class="line">Cue::_ChangeAvar(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;avarName, <span class="keywordtype">double</span> t, <span class="keywordtype">double</span> v)</div><div class="line">{</div><div class="line">    <span class="comment">// the avar changing code goes here</span></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// notify listeners that this avar has changed</span></div><div class="line">    CueChangedNotice(<span class="keyword">this</span>, avar).Send();</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="sec_tf_Notification_ThreadSafety"></a>
Thread Safety</h2>
<p>A listening object receives notices in the same thread that a notice is sent from. Thus, a listener object might call <a class="el" href="class_tf_notice.html#a68c24dba64e7a7135f62d1bdab33ca7f" title="Register a listener as being interested in a TfNotice.">TfNotice::Register()</a> in thread A, but have its notice-receiving method called in threads B and C, possibly even simultaneously. Finally, if a listening object receives a notice while being deleted, bad things can (and will) happen.</p>
<p>If you know that thread-safety is not a concern (that is, your listening object will only receive notices in one thread, and your listening object will only be deleted in that thread), then your listener object can simply derive off of <a class="el" href="class_tf_weak_base.html" title="Enable a concrete base class for use with TfWeakPtr.">TfWeakBase</a>. However, if thread-safety is a concern, there are two issues to worry about.</p>
<p>First, if your listening object receives more than one notice at the same time and that is a problem, you will need to add locking behavior into your object's method calls.</p>
<p>Second, if you are worried that your listener object might be deleted while in the middle of receiving a notice call, then you need to make your listening object support both <a class="el" href="class_tf_ref_ptr.html" title="Reference-counted smart pointer utility class.">TfRefPtr</a> and <a class="el" href="class_tf_weak_ptr.html" title="Pointer storage with deletion detection.">TfWeakPtr</a>. That is, your object must derive from <a class="el" href="class_tf_weak_base.html" title="Enable a concrete base class for use with TfWeakPtr.">TfWeakBase</a> <em>and</em> <a class="el" href="class_tf_ref_base.html" title="Enable a concrete base class for use with TfRefPtr.">TfRefBase</a> (one of the rarely allowed cases on concrete multiple inheritance) and should only be accessed through these smart pointers. Additionally, you must register your listener using TfNotice::RegisterDeletionSafe().</p>
<p>The above actions furnish a guarantee against untimely deletion, because the notification center prevents a listener from being destroyed while receiving a notice, by temporarily creating a <a class="el" href="class_tf_ref_ptr.html" title="Reference-counted smart pointer utility class.">TfRefPtr</a> pointing to the object. (In between notices, the notification center points to the listener only by a <a class="el" href="class_tf_weak_ptr.html" title="Pointer storage with deletion detection.">TfWeakPtr</a>, which allows the listener to destruct when not in use). </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tf_page_front.html">Tf: Tools Foundations</a></li>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:06:57 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>