<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: Sdr : Shader Definition Registry</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('sdr_page_front.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Sdr : Shader Definition Registry </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#SdrPropertyTypes">Discussion of SdrPropertyTypes</a></li>
</ul>
</div>
<div class="textblock"><p>Sdr is a shading-specialized version of Ndr, and provides the following specialized classes:</p><ul>
<li><code><a class="el" href="class_sdr_registry.html" title="The shading-specialized version of NdrRegistry.">SdrRegistry</a></code></li>
<li><code><a class="el" href="class_sdr_shader_node.html" title="A specialized version of NdrNode which holds shading information.">SdrShaderNode</a></code></li>
<li><code><a class="el" href="class_sdr_shader_property.html" title="A specialized version of NdrProperty which holds shading information.">SdrShaderProperty</a></code></li>
</ul>
<p>For more details on the registry, nodes, or properties, see the base Ndr classes:</p><ul>
<li><code><a class="el" href="class_ndr_registry.html" title="The registry provides access to node information.">NdrRegistry</a></code></li>
<li><code><a class="el" href="class_ndr_node.html" title="Represents an abstract node.">NdrNode</a></code></li>
<li><code><a class="el" href="class_ndr_property.html" title="Represents a property (input or output) that is part of a NdrNode instance.">NdrProperty</a></code></li>
</ul>
<p>For a high-level view of the system and how all the parts work together, see the overview page for Ndr.</p>
<h1><a class="anchor" id="SdrPropertyTypes"></a>
Discussion of SdrPropertyTypes</h1>
<p>Sdr defines a limited set of types:</p><ul>
<li>Int</li>
<li>String</li>
<li>Float</li>
<li>Color</li>
<li>Point</li>
<li>Normal</li>
<li>Vector</li>
<li>Matrix</li>
<li>Struct</li>
<li>Terminal</li>
<li>VStruct</li>
<li>Unknown</li>
</ul>
<h2>Two notions of types (SdrPropertyType and <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a>)</h2>
<p>The SdrPropertyType is not written out to a USD layer, but with the aid of other information and metadata gathered from a node's shader definition, the SdrPropertyType is mapped to an <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a> that is written into USD layers. The SdfValueTypeNames are a much richer and wider set of types, and it is this type that is looked at during opinion composition.</p>
<p>For most of the basic SdrPropertyTypes, we have direct mappings to SdfValueTypeNames given the Sdr type and if it is an array. For some of the SdrPropertyTypes, we use metadata to aid the translation to a particular <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a> (see below).</p>
<p>Clients writing <a class="el" href="class_ndr_parser_plugin.html" title="Interface for parser plugins.">NdrParserPlugin</a> sub-classes for Sdr need only be concerned with a property's SdrPropertyType. Sdr will handle the details of assigning the correct <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a>.</p>
<h2>Discussion of the special Sdr property types</h2>
<p>Some SdrPropertyTypes are a little special because there is no reasonable corresponding <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a>, so we map them all to SdfValueTypeName-&gt;Token, which is typically reserved for an Unknown type.</p>
<p>The special SdrPropertyTypes that map to 'Token' are:</p><ul>
<li>Struct - Struct types</li>
<li>Terminal - Certain properties represent 'terminal' ports (ie. surface, displacement, volume, etc)</li>
<li>Vstruct - An abstract struct type that can connect to any other 'vstruct', and connections are only made if a matching vstruct member is found.</li>
</ul>
<p>As described, these special SdrPropertyTypes cannot be represented as a <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a>, which is why we simply map them to 'Token'. A user can find the original struct type or terminal type of one of these properties by examining the 'renderType' metadata on the property, since this original type information is not preserved in either the SdrPropertyType or <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a>.</p>
<h2>Sdr metadata that is used to determine SdrPropertyType</h2>
<p>As mentioned previously, metadata can be used to drive the parsing of a SdrPropertyType. This metadata does need to be authored by shader writers. Some of these metadata tags are:</p><ul>
<li>'renderType' - The 'renderType' metadata should be specified for Struct, Terminal, and Vstruct properties.<ul>
<li>On a Struct, the metadata would be 'renderType' = 'struct structName', where structName is the actual struct's typename</li>
<li>On a Terminal, the metadata would be 'renderType' = 'terminal terminalName' where terminalName is the actual kind of terminal</li>
<li>On a Vstruct, the metadata would be 'renderType' = 'vstruct', since there is no further specific type name for a vstruct</li>
</ul>
</li>
<li>'role' - The 'role' metadata can be specified for any SdrPropertyType, and the value of 'role' will determine if the property will be transformed to a different SdrPropertyType. This metadata is special in that parser plugin writers do NOT need to handle any SdrPropertyType transformations. Parser writers simply need to parse the property as usual and allow <a class="el" href="class_sdr_shader_property.html" title="A specialized version of NdrProperty which holds shading information.">SdrShaderProperty</a> to apply any needed transformations to the SdrPropertyType. The 'role' metadata can only have the following predefined values:<ul>
<li>'none' - If 'role' is 'none', then the SdrPropertyType will be transformed to be as generic as possible. For example, if a property of original SdrPropertyTypes-&gt;Color has 'role' specified as 'none', then the property will actually become SdrPropertyTypes-&gt;Float.</li>
</ul>
</li>
</ul>
<h2>Sdr metadata that is used to determine <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a></h2>
<p>Some metadata is used to drive the conversion of an <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a>. Metadata that is used for <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a> conversion is authored either by shader writers (SdrUsdDefinitionName), or it should be injected into an <a class="el" href="class_sdr_shader_property.html" title="A specialized version of NdrProperty which holds shading information.">SdrShaderProperty</a> by a parser plugin writer (IsAssetIdentifier). This includes:</p><ul>
<li>SdrPropertyMetadata-&gt;IsAssetIdentifier - This metadata tag is injected by a parser if the parser determines that the property is an asset. The presence of this metadata tag then guides the type mapping to choose SdfValueTypeNames-&gt;Asset</li>
<li>SdrPropertyMetadata-&gt;SdrUsdDefinitionType - This metadata, explicitly authored in a shader definition, specifies the <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a> as string. Note that this metadata takes precendence in determining the <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a> for the <a class="el" href="class_sdr_shader_property.html" title="A specialized version of NdrProperty which holds shading information.">SdrShaderProperty</a>. Authors of shader definition will have to provide explicit <a class="el" href="class_tf_type.html" title="TfType represents a dynamic runtime type.">TfType</a> value aliases (Refer <a class="el" href="class_sdf_value_type_name.html#a37d2aeb7c0c3e0a39ae85f037d9bb503" title="Returns all aliases of the type name as tokens.">SdfValueTypeName::GetAliasesAsTokens()</a>) associated with the <a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a>, which generally match the type declarations found in a usda file. Example "bool" for SdfValueTypeNames-&gt;Bool, "bool[]" for SdfValueTypeNames-&gt;BoolArray, etc. This is specifically important in determining types which are represented as an "int" in the sdr type system but should be represented as SdfValueTypeNames-&gt;Bool in the equivalent Sdf/USD representation. When sdrUsdDefinitionType is specified, Sdr will do its best to convert the default value provided in the shader definition into the requested SdfValueType.</li>
</ul>
<h2>Some examples illustrating the treatment of property types</h2>
<div class="fragment"><div class="line">shader TestOSLShader</div><div class="line">(</div><div class="line">    color foo = color(1.0, 1.0 1.0),</div><div class="line">    token bar = &quot;baz&quot;,</div><div class="line">    token surface = &quot;&quot;</div><div class="line">    [[</div><div class="line">        string renderType = &quot;terminal surface&quot;</div><div class="line">    ]]</div><div class="line">)</div></div><!-- fragment --><p> In the above example, the properties would be translated as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">Property  </th><th class="markdownTableHeadLeft">SdrPropertyType  </th><th class="markdownTableHeadLeft"><a class="el" href="class_sdf_value_type_name.html" title="Represents a value type name, i.e.">SdfValueTypeName</a>   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">foo  </td><td class="markdownTableBodyLeft">SdrPropertyTypes-&gt;Color  </td><td class="markdownTableBodyLeft">SdfValueTypeNames-&gt;Color   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">bar  </td><td class="markdownTableBodyLeft">SdrPropertyTypes-&gt;String  </td><td class="markdownTableBodyLeft">SdfValueTypeNames-&gt;String   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">surface  </td><td class="markdownTableBodyLeft">SdrPropertyTypes-&gt;Terminal  </td><td class="markdownTableBodyLeft">SdfValueTypeNames-&gt;Token   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:06:57 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>