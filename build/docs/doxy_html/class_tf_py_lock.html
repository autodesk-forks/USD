<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: TfPyLock Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('class_tf_py_lock.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="class_tf_py_lock-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">TfPyLock Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Convenience class for accessing the Python Global Interpreter Lock.  
 <a href="class_tf_py_lock.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a4f3168623f7499bec5c1f985fc7caa2b"><td class="memItemLeft" align="right" valign="top">TF_API&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tf_py_lock.html#a4f3168623f7499bec5c1f985fc7caa2b">TfPyLock</a> ()</td></tr>
<tr class="memdesc:a4f3168623f7499bec5c1f985fc7caa2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Acquires the Python GIL and swaps in callers thread state.  <a href="#a4f3168623f7499bec5c1f985fc7caa2b">More...</a><br /></td></tr>
<tr class="separator:a4f3168623f7499bec5c1f985fc7caa2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13d6f5a7ac732617d5866d69a657e46d"><td class="memItemLeft" align="right" valign="top">TF_API&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tf_py_lock.html#a13d6f5a7ac732617d5866d69a657e46d">~TfPyLock</a> ()</td></tr>
<tr class="memdesc:a13d6f5a7ac732617d5866d69a657e46d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Releases Python GIL and restores prior threads state.  <a href="#a13d6f5a7ac732617d5866d69a657e46d">More...</a><br /></td></tr>
<tr class="separator:a13d6f5a7ac732617d5866d69a657e46d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cf8254141b024900e65240fda06d4b9"><td class="memItemLeft" align="right" valign="top">TF_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tf_py_lock.html#a6cf8254141b024900e65240fda06d4b9">Acquire</a> ()</td></tr>
<tr class="memdesc:a6cf8254141b024900e65240fda06d4b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Re)acquires GIL and thread state, if previously released.  <a href="#a6cf8254141b024900e65240fda06d4b9">More...</a><br /></td></tr>
<tr class="separator:a6cf8254141b024900e65240fda06d4b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8543275817d667ae015ccf2d261bd105"><td class="memItemLeft" align="right" valign="top">TF_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tf_py_lock.html#a8543275817d667ae015ccf2d261bd105">Release</a> ()</td></tr>
<tr class="memdesc:a8543275817d667ae015ccf2d261bd105"><td class="mdescLeft">&#160;</td><td class="mdescRight">Explicitly releases GIL and thread state.  <a href="#a8543275817d667ae015ccf2d261bd105">More...</a><br /></td></tr>
<tr class="separator:a8543275817d667ae015ccf2d261bd105"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1733c7e9bdad231ce5fcab3118a9ebff"><td class="memItemLeft" align="right" valign="top">TF_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tf_py_lock.html#a1733c7e9bdad231ce5fcab3118a9ebff">BeginAllowThreads</a> ()</td></tr>
<tr class="memdesc:a1733c7e9bdad231ce5fcab3118a9ebff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unlock the GIL temporarily to allow other threads to use python.  <a href="#a1733c7e9bdad231ce5fcab3118a9ebff">More...</a><br /></td></tr>
<tr class="separator:a1733c7e9bdad231ce5fcab3118a9ebff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a671cdd8b28ea97c35e890d100af8aeea"><td class="memItemLeft" align="right" valign="top">TF_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_tf_py_lock.html#a671cdd8b28ea97c35e890d100af8aeea">EndAllowThreads</a> ()</td></tr>
<tr class="memdesc:a671cdd8b28ea97c35e890d100af8aeea"><td class="mdescLeft">&#160;</td><td class="mdescRight">End allowing other threads, reacquiring the lock state.  <a href="#a671cdd8b28ea97c35e890d100af8aeea">More...</a><br /></td></tr>
<tr class="separator:a671cdd8b28ea97c35e890d100af8aeea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:a4338f16846e06b3e0cd66e74fb893e84"><td class="memItemLeft" align="right" valign="top"><a id="a4338f16846e06b3e0cd66e74fb893e84"></a>
struct&#160;</td><td class="memItemRight" valign="bottom"><b>TfPyEnsureGILUnlockedObj</b></td></tr>
<tr class="separator:a4338f16846e06b3e0cd66e74fb893e84"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Convenience class for accessing the Python Global Interpreter Lock. </p>
<p>The Python API is not thread-safe. Accessing the Python API from outside the context of Python execution requires extra care when multiple threads may be present. There are various schemes for how this should be done, and the conventions have been changing with Python versions through 2.X.</p>
<p>This class provides a convenient and centralized location for managing the Python Global Interpreter Lock and related Python Thread State.</p>
<p>The easiest way to use this class is to simply create a local variable in any function that will access the Python API. Upon construction, this will acquire the Python lock and establish the correct thread state for the caller. Upon exit from the current scope, when the instance is destroyed, the thread state will be restored and the lock will be released.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyFunc()</div><div class="line">{</div><div class="line">    <a class="code" href="class_tf_py_lock.html">TfPyLock</a> dummy;</div><div class="line">    ...(access Python API)...</div><div class="line">}</div></div><!-- fragment --><p>If you need to temporarily release the lock during execution, (to perform blocking I/O for example), you can call <a class="el" href="class_tf_py_lock.html#a8543275817d667ae015ccf2d261bd105" title="Explicitly releases GIL and thread state.">Release()</a> explicitly, then call <a class="el" href="class_tf_py_lock.html#a6cf8254141b024900e65240fda06d4b9" title="(Re)acquires GIL and thread state, if previously released.">Acquire()</a> again to reclaim the lock.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyFunc()</div><div class="line">{</div><div class="line">    <a class="code" href="class_tf_py_lock.html">TfPyLock</a> pyLock;</div><div class="line">    ...(access Python API)...</div><div class="line">    pyLock.<a class="code" href="class_tf_py_lock.html#a8543275817d667ae015ccf2d261bd105">Release</a>();  <span class="comment">// let other threads run while we&#39;re blocked</span></div><div class="line">    ...(some blocking I/O or <span class="keywordtype">long</span> running operation)...</div><div class="line">    pyLock.<a class="code" href="class_tf_py_lock.html#a6cf8254141b024900e65240fda06d4b9">Acquire</a>();</div><div class="line">    ...(more access to Python API)...</div><div class="line">}</div></div><!-- fragment --><p>Note that it IS EXPLICITLY OK to recursively create instances of this class, and thus recursively acquire the GIL and thread state. It is NOT OK to recursively attempt to <a class="el" href="class_tf_py_lock.html#a6cf8254141b024900e65240fda06d4b9" title="(Re)acquires GIL and thread state, if previously released.">Acquire()</a> the same instance, that will have no effect and will generate a diagnostic warning.</p>
<p>This class also provides an exception-safe way to release the GIL temporarily for blocking calls, like Py_BEGIN/END_ALLOW_THREADS in the Python C API.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyFunc()</div><div class="line">{</div><div class="line">    <a class="code" href="class_tf_py_lock.html">TfPyLock</a> lock;</div><div class="line">    ...(access Python API)...</div><div class="line">    lock.<a class="code" href="class_tf_py_lock.html#a1733c7e9bdad231ce5fcab3118a9ebff">BeginAllowThreads</a>(); <span class="comment">// totally unlock the GIL temporarily.</span></div><div class="line">    ...(some blocking I/O or <span class="keywordtype">long</span> running operation)...</div><div class="line">    lock.<a class="code" href="class_tf_py_lock.html#a671cdd8b28ea97c35e890d100af8aeea">EndAllowThreads</a>();</div><div class="line">    ...(more access to Python API)...</div><div class="line">}</div></div><!-- fragment --><p>This looks similar to the above example using <em><a class="el" href="class_tf_py_lock.html#a8543275817d667ae015ccf2d261bd105" title="Explicitly releases GIL and thread state.">Release()</a></em>, but it is different. The Python lock is recursive, so the call to <em><a class="el" href="class_tf_py_lock.html#a8543275817d667ae015ccf2d261bd105" title="Explicitly releases GIL and thread state.">Release()</a></em> is not guaranteed to actually release the lock, it just releases the deepest lock. In contrast <em><a class="el" href="class_tf_py_lock.html#a1733c7e9bdad231ce5fcab3118a9ebff" title="Unlock the GIL temporarily to allow other threads to use python.">BeginAllowThreads()</a></em> will fully unlock the GIL so that other threads can run temporarily regardless of how many times the lock is recursively taken.</p>
<p>The valid states and transitions for this class are as follows.</p>
<h2>State Valid Transitions </h2>
<p>Released <a class="el" href="class_tf_py_lock.html#a6cf8254141b024900e65240fda06d4b9" title="(Re)acquires GIL and thread state, if previously released.">Acquire()</a> -&gt; Acquired Acquired <a class="el" href="class_tf_py_lock.html#a8543275817d667ae015ccf2d261bd105" title="Explicitly releases GIL and thread state.">Release()</a> -&gt; Released, <a class="el" href="class_tf_py_lock.html#a1733c7e9bdad231ce5fcab3118a9ebff" title="Unlock the GIL temporarily to allow other threads to use python.">BeginAllowThreads()</a> -&gt; AllowsThreads AllowsThreads <a class="el" href="class_tf_py_lock.html#a671cdd8b28ea97c35e890d100af8aeea" title="End allowing other threads, reacquiring the lock state.">EndAllowThreads()</a> -&gt; Acquired</p>
<p>Note that upon construction the class is in the Acquired state. Upon destruction, the class will move to the Released state.</p>
<dl class="section warning"><dt>Warning</dt><dd>Instances of this class should only be used as automatic (stack) variables, or in thread local storage. DO NOT create a single instance that could be shared across multiple threads. </dd></dl>

<p class="definition">Definition at line <a class="el" href="py_lock_8h_source.html#l00122">122</a> of file <a class="el" href="py_lock_8h_source.html">pyLock.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a4f3168623f7499bec5c1f985fc7caa2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f3168623f7499bec5c1f985fc7caa2b">&#9670;&nbsp;</a></span>TfPyLock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TF_API <a class="el" href="class_tf_py_lock.html">TfPyLock</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Acquires the Python GIL and swaps in callers thread state. </p>

</div>
</div>
<a id="a13d6f5a7ac732617d5866d69a657e46d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13d6f5a7ac732617d5866d69a657e46d">&#9670;&nbsp;</a></span>~TfPyLock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TF_API ~<a class="el" href="class_tf_py_lock.html">TfPyLock</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Releases Python GIL and restores prior threads state. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a6cf8254141b024900e65240fda06d4b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cf8254141b024900e65240fda06d4b9">&#9670;&nbsp;</a></span>Acquire()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TF_API void Acquire </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(Re)acquires GIL and thread state, if previously released. </p>

</div>
</div>
<a id="a1733c7e9bdad231ce5fcab3118a9ebff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1733c7e9bdad231ce5fcab3118a9ebff">&#9670;&nbsp;</a></span>BeginAllowThreads()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TF_API void BeginAllowThreads </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unlock the GIL temporarily to allow other threads to use python. </p>
<p>Typically this is used to unblock threads during operations like blocking I/O. The lock must be acquired when called. </p>

</div>
</div>
<a id="a671cdd8b28ea97c35e890d100af8aeea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a671cdd8b28ea97c35e890d100af8aeea">&#9670;&nbsp;</a></span>EndAllowThreads()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TF_API void EndAllowThreads </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>End allowing other threads, reacquiring the lock state. </p>
<p><em>BeginAllowThreads</em> must have been successfully called first. </p>

</div>
</div>
<a id="a8543275817d667ae015ccf2d261bd105"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8543275817d667ae015ccf2d261bd105">&#9670;&nbsp;</a></span>Release()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TF_API void Release </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Explicitly releases GIL and thread state. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>pxr/base/tf/<a class="el" href="py_lock_8h_source.html">pyLock.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="class_tf_py_lock.html">TfPyLock</a></li>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:07:05 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>