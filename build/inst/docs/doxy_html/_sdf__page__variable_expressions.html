<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: Variable Expressions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_sdf__page__variable_expressions.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Variable Expressions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Variable expressions are specially formatted strings that contain expressions that USD will evaluate at runtime. The expressions can contain variable data and logic used to dynamically create values. Variable expressions make use of named expression variables that can be easily defined and changed in layer metadata. Expression variables are defined in a "expressionVariables" dictionary metadata field in a layer.</p>
<p>Variable expressions can currently be used in:</p>
<ul>
<li>Asset paths (including sublayer, reference, and payload asset paths as well as asset-valued attributes and metadata)</li>
<li>Variant selections</li>
</ul>
<p>The following simple example demonstrates using variable expressions to specify a reference path and a variant selection. An ASSET_PATH expression variable is set to a directory, and then used in a reference variable expression. Similarly, a VARIANT_CHOICE expression variable is defined and then used in a variable expression for selecting a variant.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#usda 1.0</span></div><div class="line">(</div><div class="line">    expressionVariables = {</div><div class="line"><span class="preprocessor">        # Define path to reference that can be changed as needed</span></div><div class="line">        <span class="keywordtype">string</span> ASSET_PATH = <span class="stringliteral">&quot;/finalAssets/SetA&quot;</span></div><div class="line"><span class="preprocessor">        # Define the expression variable that can be changed as needed</span></div><div class="line">        <span class="keywordtype">string</span> VARIANT_CHOICE = <span class="stringliteral">&quot;variantA&quot;</span></div><div class="line">    }</div><div class="line">)</div><div class="line">over <span class="stringliteral">&quot;asset0&quot;</span> (</div><div class="line">    # Use a variable expression to complete the reference asset path</div><div class="line">    references = @`<span class="stringliteral">&quot;${ASSET_PATH}/extraAssets.usda&quot;</span>`@&lt;/asset0&gt;</div><div class="line">)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line">def Xform <span class="stringliteral">&quot;asset1&quot;</span> (</div><div class="line">    variants = {</div><div class="line"><span class="preprocessor">        # Use a variable expression for specifying the variant</span></div><div class="line">        <span class="keywordtype">string</span> displayVariantSet = <span class="stringliteral">&quot;`${VARIANT_CHOICE}`&quot;</span></div><div class="line">    }</div><div class="line">    prepend variantSets = <span class="stringliteral">&quot;displayVariantSet&quot;</span></div><div class="line">)</div><div class="line">{</div><div class="line">    ...displayVariantSet definition omitted...</div><div class="line">}</div></div><!-- fragment --><p>See <a href="https://openusd.org/release/user_guides/variable_expressions.html">Variable Expressions</a> for user documentation on using variable expressions in your USD scene data, and reference information on the variable expressions supported syntax.</p>
<h1><a class="anchor" id="VariableExpressions_Composition_Evaluation"></a>
Understanding Variable Expression Composition and Evaluation</h1>
<p>Expression variables do not compose across sublayers, but do compose in references and payloads, as described in <a href="https://openusd.org/release/user_guides/variable_expressions.html#expression-variables-and-composition">Expression Variables and Composition</a>.</p>
<p>For asset paths using variable expressions, USD will always evaluate the expression before passing the result to Ar for path resolution. If Ar returns a resolved path that looks like an expression, USD doesn't evaluate that expression.</p>
<p>Expressions in asset paths used in composition arcs are evaluated during the composition process. For asset path-valued attributes, USD will do the evaluation and resolution when <a class="el" href="class_usd_attribute.html#a9d41bc223be86408ba7d7f74df7c35a9" title="Perform value resolution to fetch the value of this attribute at the requested UsdTimeCode time,...">UsdAttribute::Get</a> (or similar methods) are called.</p>
<h1><a class="anchor" id="VariableExpressions_Variables"></a>
Working with Expression Variables</h1>
<p>To work with a layer's expression variables dictionary, use <a class="el" href="class_sdf_layer.html" title="A scene description container that can combine with other such containers to form simple component as...">SdfLayer</a>'s GetExpressionVariables(), SetExpressionVariables(), HasExpressionVariables(), and ClearExpressionVariables() methods.</p>
<div class="fragment"><div class="line">SdfLayerHandle rootLayer = stage-&gt;GetRootLayer();</div><div class="line"><span class="keywordflow">if</span> (rootLayer-&gt;HasExpressionVariables()) {</div><div class="line">    <span class="comment">// Inspect expression variables using GetExpressionVariables() </span></div><div class="line">    <a class="code" href="class_vt_dictionary.html">VtDictionary</a> expressionVars = rootLayer-&gt;GetExpressionVariables();</div><div class="line">    <span class="comment">// ... </span></div><div class="line">    <span class="comment">// Clear expression variables using ClearExpressionVariables()</span></div><div class="line">    rootLayer-&gt;ClearExpressionVariables();</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="VariableExpressions_Expressions"></a>
Working with Expressions</h1>
<p>Variable expressions are treated as strings in USD data, so there's no special API for creating expressions. You can use expression strings in existing asset path and variant APIs.</p>
<div class="fragment"><div class="line"><span class="comment">// Asset Paths:</span></div><div class="line"><a class="code" href="class_sdf_asset_path.html">SdfAssetPath</a> assetPathWithExpr(<span class="stringliteral">&quot;`extraAsset_${referenceQualifier}.usda`&quot;</span>);</div><div class="line"> </div><div class="line"><span class="comment">// Variant Selections:</span></div><div class="line">workVariantSet.SetVariantSelection(<span class="stringliteral">&quot;`${variantSel}`&quot;</span>);</div></div><!-- fragment --><p>For evaluating a variable expression, use Sdf's VariableExpression class.</p>
<div class="fragment"><div class="line"><a class="code" href="class_sdf_variable_expression.html">SdfVariableExpression</a> workVarExp(<span class="stringliteral">&quot;`${myVariable}`&quot;</span>);</div><div class="line"><a class="code" href="class_vt_dictionary.html">VtDictionary</a> expressionVars = rootLayer-&gt;GetExpressionVariables();</div><div class="line">SdfVariableExpression::Result workResult = workVarExp.Evaluate(expressionVars);</div><div class="line"><span class="comment">// Inspect evaluation errors</span></div><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Evaluation errors:\n&quot;</span>;</div><div class="line"><span class="keywordflow">for</span> (std::string &amp;error : workResult.errors) {</div><div class="line">    std::cout &lt;&lt; error &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">}</div><div class="line"><span class="comment">// ...inspect and use workResult.value as needed...</span></div></div><!-- fragment --><h1><a class="anchor" id="VariableExpressions_Notifications"></a>
Change Notifications</h1>
<p>Changes to expression variables that are used in expressions in references and other composition arcs will trigger recomposition as needed.</p>
<p>Changes that affect expressions in asset path-valued attributes and metadata will trigger a UsdNotice::ObjectsChange notice containing resolved asset path resyncs to be sent. This informs clients that asset paths in the specified subtrees of the scenegraph may now resolve to different locations. This broad notification is needed because <a class="el" href="class_usd_stage.html" title="The outermost container for scene description, which owns and presents composed prims as a scenegraph...">UsdStage</a> currently does not cache or pre-compute expression values to know precisely which objects (if any) were affected by such a change. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="sdf_page_front.html">Sdf : Scene Description Foundations</a></li>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:06:57 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>