<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: HdDirtyList Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('class_hd_dirty_list.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_hd_dirty_list-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">HdDirtyList Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Used for faster iteration of dirty Rprims by the render index.  
 <a href="class_hd_dirty_list.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3e8e1c43cc8c663826f1e43d44582052"><td class="memItemLeft" align="right" valign="top"><a id="a3e8e1c43cc8c663826f1e43d44582052"></a>
HD_API&#160;</td><td class="memItemRight" valign="bottom"><b>HdDirtyList</b> (<a class="el" href="class_hd_render_index.html">HdRenderIndex</a> &amp;index)</td></tr>
<tr class="separator:a3e8e1c43cc8c663826f1e43d44582052"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfe44906ba88577392dc5d41b132fe6e"><td class="memItemLeft" align="right" valign="top">HD_API SdfPathVector const  &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hd_dirty_list.html#adfe44906ba88577392dc5d41b132fe6e">GetDirtyRprims</a> ()</td></tr>
<tr class="memdesc:adfe44906ba88577392dc5d41b132fe6e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a reference of dirty rprim ids.  <a href="#adfe44906ba88577392dc5d41b132fe6e">More...</a><br /></td></tr>
<tr class="separator:adfe44906ba88577392dc5d41b132fe6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a592f378dfe4b60dd35893b1b67b2ecf3"><td class="memItemLeft" align="right" valign="top">HD_API void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hd_dirty_list.html#a592f378dfe4b60dd35893b1b67b2ecf3">UpdateRenderTagsAndReprSelectors</a> (<a class="el" href="token_8h.html#a9d94c69b8de3eb7202797d3c6d56db59">TfTokenVector</a> const &amp;tags, HdReprSelectorVector const &amp;reprs)</td></tr>
<tr class="memdesc:a592f378dfe4b60dd35893b1b67b2ecf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Updates the tracked filtering parameters.  <a href="#a592f378dfe4b60dd35893b1b67b2ecf3">More...</a><br /></td></tr>
<tr class="separator:a592f378dfe4b60dd35893b1b67b2ecf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d1ba4ceff87fd263d1cf1c9e91f413e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_hd_dirty_list.html#a1d1ba4ceff87fd263d1cf1c9e91f413e">PruneToVaryingRprims</a> ()</td></tr>
<tr class="memdesc:a1d1ba4ceff87fd263d1cf1c9e91f413e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the flag to prune to dirty list to just the varying Rprims on the next call to GetDirtyRprims.  <a href="#a1d1ba4ceff87fd263d1cf1c9e91f413e">More...</a><br /></td></tr>
<tr class="separator:a1d1ba4ceff87fd263d1cf1c9e91f413e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Used for faster iteration of dirty Rprims by the render index. </p>
<p><a class="el" href="class_hd_dirty_list.html#adfe44906ba88577392dc5d41b132fe6e" title="Returns a reference of dirty rprim ids.">GetDirtyRprims()</a> implicitly refreshes and caches the list if needed. The returning prims list will be used for sync.</p>
<p>DirtyList construction can expensive. We have 3 layer versioning to make it efficient.</p>
<ol type="1">
<li>Nothing changed since last time (super fast), no prims need to be synced. DirtyList returns empty vector GetDirtyRprims. This can be detected by <a class="el" href="class_hd_change_tracker.html#a388b88aa3fdd7ee1689f4325b9399445" title="Returns the current version of the scene state.">HdChangeTracker::GetSceneStateVersion</a>. It's incremented when any change made on any prim.</li>
<li><p class="startli">Constantly updating Prims in a stable set (fast) when munging or playing back, the same set of prims are being updated, while the remaining prims (could be huge &ndash; for example a large set) are static. Those animating prims can be distinguished by the Varying bit. The Varying bit is set on a prim when any dirty bit is set, and stays even after cleaning the scene dirty bits, until <a class="el" href="class_hd_change_tracker.html#a861627500b20b88ee6ac7d887a4cd4b9" title="Clear Varying bit of all prims.">HdChangeTracker::ResetVaryingState</a> clears it out.</p>
<p class="startli">DirtyList caches those prims in a list at the first time (described in 3), and returns the list for the subsequent queries. Since that list is conservatively picked by the Varying bit instead of the actual DirtyBits needed for various reprs, consumer of DirtyList needs to check the dirtybits again (this is a common pattern in <a class="el" href="class_hd_rprim.html" title="The render engine state for a given rprim from the scene graph.">HdRprim</a>, <a class="el" href="class_hd_mesh.html" title="Hydra Schema for a subdivision surface or poly-mesh object.">HdMesh</a> and other).</p>
</li>
<li><p class="startli">Varying state changed (medium cost) when a exisitng prim newly starts updating (start munging), or when a majority of the dirtylist stop updating, we need to reconstruct the dirtylist. <a class="el" href="class_hd_change_tracker.html#a8fbe49ed63dd729be17f23df0fdb65c9" title="Returns the current version of varying state.">HdChangeTracker::GetVaryingStateVersion()</a> tells the right timing to refresh, by comparing the cached version number in the dirtylist.</p>
<p class="startli">To construct a dirtylist, the Varying bit is checked instead of other dirtybits, since effective dirtybits may differ over prims, by prim type (mesh vs curve) or by per-prim repr style (flat vs smooth)</p>
<p class="startli">example: [x]=Varying [x*]=Dirty,Varying</p>
<p class="startli">say in change tracker: A B C D E [F*] [G] [H*] [I*] [J] [K] L M N ... then the dirtylist will be: F*, G, H*, I*, J, K</p>
<p class="startli">Note that G, J and K are not dirty, but it exists in the dirtylist. This optimization gives the maximum efficiency when all of Varying prims are being updated.</p>
</li>
<li>Initial creation, filter changes (most expensive) If we fail to early out all the above condition, such as when we add new prims or switch the render tag set, all prims should be passed down to HdRenderIndex::Sync, except ones we know that are completely clean. Although it requires to sweep all prims in the render index, this traversal has already been optimized using the Gather utility. </li>
</ol>

<p class="definition">Definition at line <a class="el" href="dirty_list_8h_source.html#l00103">103</a> of file <a class="el" href="dirty_list_8h_source.html">dirtyList.h</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="adfe44906ba88577392dc5d41b132fe6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfe44906ba88577392dc5d41b132fe6e">&#9670;&nbsp;</a></span>GetDirtyRprims()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HD_API SdfPathVector const&amp; GetDirtyRprims </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a reference of dirty rprim ids. </p>
<p>If the change tracker hasn't changed any state since the last time GetDirtyRprims gets called, and if the tracked filtering parameters (set via UpdateRenderTagsAndReprSelectors) are the same, it simply returns an empty list. Otherwise depending on what changed, it will return a list of Rprim ids to be synced. Therefore, it is expected that GetDirtyRprims is called <em>only once</em> per render index sync. </p>

</div>
</div>
<a id="a1d1ba4ceff87fd263d1cf1c9e91f413e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d1ba4ceff87fd263d1cf1c9e91f413e">&#9670;&nbsp;</a></span>PruneToVaryingRprims()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void PruneToVaryingRprims </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets the flag to prune to dirty list to just the varying Rprims on the next call to GetDirtyRprims. </p>

<p class="definition">Definition at line <a class="el" href="dirty_list_8h_source.html#l00128">128</a> of file <a class="el" href="dirty_list_8h_source.html">dirtyList.h</a>.</p>

</div>
</div>
<a id="a592f378dfe4b60dd35893b1b67b2ecf3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a592f378dfe4b60dd35893b1b67b2ecf3">&#9670;&nbsp;</a></span>UpdateRenderTagsAndReprSelectors()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HD_API void UpdateRenderTagsAndReprSelectors </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="token_8h.html#a9d94c69b8de3eb7202797d3c6d56db59">TfTokenVector</a> const &amp;&#160;</td>
          <td class="paramname"><em>tags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HdReprSelectorVector const &amp;&#160;</td>
          <td class="paramname"><em>reprs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Updates the tracked filtering parameters. </p>
<p>This typically comes from the tasks submitted to <a class="el" href="class_hd_engine.html#a75a0815239165c0bf1826a09415013a5" title="Execute tasks.">HdEngine::Execute</a>. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>pxr/imaging/hd/<a class="el" href="dirty_list_8h_source.html">dirtyList.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="class_hd_dirty_list.html">HdDirtyList</a></li>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:06:59 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>