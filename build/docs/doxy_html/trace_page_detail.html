<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: Trace Details</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('trace_page_detail.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Trace Details </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The trace library consists of two main components:</p>
<ul>
<li><a class="el" href="class_trace_collector.html" title="This is a singleton class that records TraceEvent instances and populates TraceCollection instances.">TraceCollector</a> is a singleton thread-safe recorder of events. </li>
<li><a class="el" href="class_trace_reporter.html" title="This class converts streams of TraceEvent objects into call trees which can then be used as a data so...">TraceReporter</a> is a class which processes events to create meaningful views of the data.</li>
</ul>
<p>The <a class="el" href="class_trace_collector.html" title="This is a singleton class that records TraceEvent instances and populates TraceCollection instances.">TraceCollector</a> class can be used as a recorder for custom events in an application without using TRACE_ macros. </p>
<h1><a class="anchor" id="trace_detail_contents"></a>
Contents</h1>
<ul>
<li><a class="el" href="trace_page_detail.html#trace_store_data">Recording Events with TraceCollector</a> </li>
<li><a class="el" href="trace_page_detail.html#trace_data">Accessing Trace Data</a> </li>
<li><a class="el" href="trace_page_detail.html#trace_custom_example">Example of Custom Category and Reporter</a></li>
</ul>
<h1><a class="anchor" id="trace_store_data"></a>
Recording Events with TraceCollector</h1>
<p>Most of the time TRACE macros are sufficient for instrumentation, however if something more specific is required, the <a class="el" href="class_trace_collector.html" title="This is a singleton class that records TraceEvent instances and populates TraceCollection instances.">TraceCollector</a> class can be used directly without using TRACE_ macros. The macros simply invoke API on the <a class="el" href="class_trace_collector.html" title="This is a singleton class that records TraceEvent instances and populates TraceCollection instances.">TraceCollector</a>.</p>
<ul>
<li><a class="el" href="trace_8h.html#a5b0af4118bc65ec32e2f5d2558fe90d5" title="Records a timestamp when constructed and a timespan event when destructed, using the name of the func...">TRACE_FUNCTION()</a>, <a class="el" href="trace_8h.html#aec9f2bb2b5d0fd9be6ba7cddbce26cf1" title="Records a timestamp when constructed and a timespan event when destructed, using the name of the func...">TRACE_FUNCTION_SCOPE()</a>, and <a class="el" href="trace_8h.html#a39c16c77a53bc0aaaf4f2f39cd37f6c0" title="Records a timestamp when constructed and a timespan event when destructed, using name as the key.">TRACE_SCOPE()</a> corresponds to calls to <a class="el" href="class_trace_collector.html#a81f8d63e47276778589f4642747829d7" title="Record a scope event described by key that started at start for the DefaultCategory.">TraceCollector::Scope</a> </li>
<li><a class="el" href="trace_8h.html#a23cc37038341ab22266c26144b909a4c" title="Records a counter delta using the name as the counter key.">TRACE_COUNTER_DELTA()</a> corresponds to a call to <a class="el" href="class_trace_collector.html#a19b4d09df7c51c157bebc19f36339faf" title="Record a counter delta for a name key if Category is enabled.">TraceCollector::RecordCounterDelta</a> </li>
<li><a class="el" href="trace_8h.html#aa24afd97283177cabfdc766c8ac77338" title="Records a counter value using the name as the counter key.">TRACE_COUNTER_VALUE()</a> corresponds to a call to <a class="el" href="class_trace_collector.html#aa30e743a52551ee5fd482dda7b04d894" title="Record a counter value for a name key if Category is enabled.">TraceCollector::RecordCounterValue</a></li>
</ul>
<p>Each <a class="el" href="class_trace_event.html" title="This represents an event recorded by a TraceCollector.">TraceEvent</a> contains a <a class="el" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a>. These ids allow for the events to be filtered. Events recorded by TRACE_ macros have their <a class="el" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a> set to TraceCategory::Default.</p>
<p>Trace categories consist of two parts, a <a class="el" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a>, and a function to determine whether or not events for the category should be recorded.</p>
<p><a class="el" href="class_trace_category.html#a4a14344b5bd6c66eb04727b11fae850b" title="Computes an id for the given a string literal str.">TraceCategory::CreateTraceCategoryId</a> can create a <a class="el" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a> from hashing a string literal. This is not guaranteed to be unique.</p>
<p>All of the methods in the <a class="el" href="class_trace_collector.html" title="This is a singleton class that records TraceEvent instances and populates TraceCollection instances.">TraceCollector</a> class which record events take an optional Category template parameter. The Category template parameter determines if the event will be recorded and the <a class="el" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a> that will be stored in the event. </p>
<p>A valid Category template parameter must have have the following: </p><ul>
<li>A thread-safe static method named <b>GetId</b> which returns a TraceCategoryId. </li>
<li>A thread-safe static method named <b>IsEnabled</b> which returns a bool. </li>
</ul>
<p>If the Category template parameter is not specified, <a class="el" href="class_trace_collector.html" title="This is a singleton class that records TraceEvent instances and populates TraceCollection instances.">TraceCollector</a> uses <a class="el" href="struct_trace_collector_1_1_default_category.html" title="Default Trace category which corresponds to events stored for TRACE_ macros.">TraceCollector::DefaultCategory</a>.</p>
<p>Example of recording an event with a custom category. </p><div class="fragment"><div class="line"><span class="comment">// Define a custom category.</span></div><div class="line"><span class="keyword">struct </span>CustomPerfCounterCategory</div><div class="line">{</div><div class="line">    <span class="comment">// TraceCollector function calls using this category will store events with this TraceCategoryId.</span></div><div class="line">    <span class="keyword">static</span> constexpr <a class="code" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a> GetId() {</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="class_trace_category.html#a4a14344b5bd6c66eb04727b11fae850b">TraceCategory::CreateTraceCategoryId</a>(<span class="stringliteral">&quot;CustomPerfCounter&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// TraceCollector function calls using this category will store events only if this function returns true.</span></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> IsEnabled();</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="comment">// Register a name with the id.</span></div><div class="line">    <a class="code" href="class_trace_category.html#a843883928c4ee80ce9d7e0143debaa18">TraceCategory::GetInstance</a>().<a class="code" href="class_trace_category.html#a8eb33c2cb2b06b0f3e3e8f4f8b0ff9e5">RegisterCategory</a>(PerfCategory::GetId(), <span class="stringliteral">&quot;CustomPerfCounter&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Record a counter delta event with the CustomPerfCounterCategory.</span></div><div class="line">    <a class="code" href="class_trace_collector.html#a7c6ef45a242396370e5d51e4c0ed8ec7">TraceCollector::GetInstance</a>().<a class="code" href="class_trace_collector.html#a19b4d09df7c51c157bebc19f36339faf">RecordCounterDelta</a>&lt;CustomPerfCounterCategory&gt;(<span class="stringliteral">&quot;A Counter&quot;</span>, 1);</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="trace_data"></a>
Accessing Trace Data</h1>
<p>Access to recorded <a class="el" href="class_trace_event.html" title="This represents an event recorded by a TraceCollector.">TraceEvent</a> objects is available through the <a class="el" href="class_trace_collection.html" title="This class owns lists of TraceEvent instances per thread, and allows read access to them.">TraceCollection</a> class and <a class="el" href="class_trace_collection_available.html" title="A TfNotice that is sent when the TraceCollector creates a TraceCollection.">TraceCollectionAvailable</a> notice. When the <a class="el" href="class_trace_collector.html" title="This is a singleton class that records TraceEvent instances and populates TraceCollection instances.">TraceCollector</a> produces data through the <a class="el" href="class_trace_collector.html#a6662f531d89c418a2266ecf7487c44a2" title="Produces a TraceCollection from all the events that recorded in the collector and issues a TraceColle...">TraceCollector::CreateCollection()</a> method, it will send a <a class="el" href="class_trace_collection_available.html" title="A TfNotice that is sent when the TraceCollector creates a TraceCollection.">TraceCollectionAvailable</a> notice. To access individual events in a <a class="el" href="class_trace_collection.html" title="This class owns lists of TraceEvent instances per thread, and allows read access to them.">TraceCollection</a> instance, the <a class="el" href="class_trace_collection_1_1_visitor.html" title="This interface provides a way to access data a TraceCollection.">TraceCollection::Visitor</a> interface can be used. The <a class="el" href="class_trace_reporter_base.html" title="This class is a base class for report implementations.">TraceReporterBase</a> class encapsulates logic for handling <a class="el" href="class_trace_collection_available.html" title="A TfNotice that is sent when the TraceCollector creates a TraceCollection.">TraceCollectionAvailable</a> notices.</p>
<p>Example of using <a class="el" href="class_trace_reporter_base.html" title="This class is a base class for report implementations.">TraceReporterBase</a> class and <a class="el" href="class_trace_collection_1_1_visitor.html" title="This interface provides a way to access data a TraceCollection.">TraceCollection::Visitor</a> interface. </p><div class="fragment"><div class="line"><span class="keyword">class </span>CustomTraceEventProcessor : </div><div class="line">    <span class="keyword">public</span> <a class="code" href="class_trace_reporter_base.html">TraceReporterBase</a>, <a class="code" href="class_trace_collection_1_1_visitor.html">TraceCollection::Visitor</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    CustomTraceEventProcessor();</div><div class="line"></div><div class="line">    <span class="comment">// TraceCollection::Visitor interface</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a2250f04e7b002aa6c36a168a6e947a01">AcceptsCategory</a>(<a class="code" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a> <span class="keywordtype">id</span>) <span class="keyword">override</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#ae291c275f770fb50cd9e3d369ebca9e0">OnEvent</a>(</div><div class="line">        <span class="keyword">const</span> <a class="code" href="class_trace_thread_id.html">TraceThreadId</a>&amp;, <span class="keyword">const</span> <a class="code" href="class_tf_token.html">TfToken</a>&amp; k, <span class="keyword">const</span> <a class="code" href="class_trace_event.html">TraceEvent</a>&amp; e) <span class="keyword">override</span>;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a3c80c02c9ef4c21cc42fc923138704a8">OnBeginCollection</a>() <span class="keyword">override</span>;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a6dfb37e0b38497f0e93dd9f3c5dc4bb3">OnEndCollection</a>() <span class="keyword">override</span>;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a40662d18c54cefe17fce74f0d5e5b17d">OnBeginThread</a>(<span class="keyword">const</span> <a class="code" href="class_trace_thread_id.html">TraceThreadId</a>&amp;) <span class="keyword">override</span>;</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a699411304ea70999cea0158fa076b613">OnEndThread</a>(<span class="keyword">const</span> <a class="code" href="class_trace_thread_id.html">TraceThreadId</a>&amp;) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> Update() {</div><div class="line">        <span class="comment">//Call base class update to get the latest data from TraceCollector.</span></div><div class="line">        <a class="code" href="class_trace_reporter_base.html#a10d708889f4d8c7dc8acfddb77936c51">_Update</a>();</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="comment">// This will be called by the TraceReporterBase::_Update() for each</span></div><div class="line">    <span class="comment">// TraceCollection received.</span></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="class_trace_reporter_base.html#a5271f5249704bb4c54f18a2a7a56e410">_ProcessCollection</a>(<span class="keyword">const</span> CollectionPtr&amp; collection)<span class="keyword"> override </span>{</div><div class="line">        <span class="comment">// Iterate over the TraceCollection using the TraceCollection::Visitor</span></div><div class="line">        <span class="comment">// interface.</span></div><div class="line">        collection-&gt;Iterate(*<span class="keyword">this</span>);</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><h1><a class="anchor" id="trace_custom_example"></a>
Example of Custom Category and Reporter</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;pxr/base/trace/collector.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;pxr/base/trace/reporterBase.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;atomic&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"></div><div class="line">PXR_NAMESPACE_USING_DIRECTIVE</div><div class="line"></div><div class="line"><span class="comment">// Custom Trace category.</span></div><div class="line"><span class="keyword">struct </span>CustomPerfCounterCategory</div><div class="line">{</div><div class="line">    <span class="comment">// TraceCollector function calls using this category will store events with this TraceCategoryId.</span></div><div class="line">    <span class="keyword">static</span> constexpr <a class="code" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a> GetId() {</div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="class_trace_category.html#a4a14344b5bd6c66eb04727b11fae850b">TraceCategory::CreateTraceCategoryId</a>(<span class="stringliteral">&quot;CustomPerfCounter&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="comment">// TraceCollector function calls using this category will store events only if this function return true.</span></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> IsEnabled() {</div><div class="line">        <span class="keywordflow">return</span> _isEnabled.load(std::memory_order_acquire);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> Enable() {</div><div class="line">        _isEnabled.store(<span class="keyword">true</span>, std::memory_order_release);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> Disable() {</div><div class="line">        _isEnabled.store(<span class="keyword">false</span>, std::memory_order_release);</div><div class="line">    }</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">static</span> std::atomic&lt;bool&gt; _isEnabled;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// Helper macros</span></div><div class="line"><span class="preprocessor">#define CUSTOM_PERF_COUNTER(name, value) \</span></div><div class="line"><span class="preprocessor">    _CUSTOM_PERF_COUNTER_INSTANCE(__LINE__, name, value)</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define _CUSTOM_PERF_COUNTER_INSTANCE(inst, name, value) \</span></div><div class="line"><span class="preprocessor">    static constexpr TraceStaticKeyData customCounterKey ## inst (name); \</span></div><div class="line"><span class="preprocessor">    TraceCollector::GetInstance().RecordCounterDelta&lt;CustomPerfCounterCategory&gt;(customCounterKey ## inst, value);</span></div><div class="line"></div><div class="line"><span class="comment">// Custom Trace reporter.</span></div><div class="line"><span class="keyword">class </span>CustomTraceEventProcessor : </div><div class="line">    <span class="keyword">public</span> <a class="code" href="class_trace_reporter_base.html">TraceReporterBase</a>, <a class="code" href="class_trace_collection_1_1_visitor.html">TraceCollection::Visitor</a> {</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    CustomTraceEventProcessor(TraceReporterDataSourceBaseRefPtr dataSource)</div><div class="line">        : <a class="code" href="class_trace_reporter_base.html">TraceReporterBase</a>(dataSource)</div><div class="line">        {}</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> Update() {</div><div class="line">        <span class="comment">//Call base class update to get the latest data from TraceCollector.</span></div><div class="line">        <a class="code" href="class_trace_reporter_base.html#a10d708889f4d8c7dc8acfddb77936c51">_Update</a>();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// TraceCollection::Visitor interface</span></div><div class="line"></div><div class="line">    <span class="comment">// Only visit events marked with the custom category.</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a2250f04e7b002aa6c36a168a6e947a01">AcceptsCategory</a>(<a class="code" href="category_8h.html#a3a221cd36270fa5e1bee9476d0c6013e">TraceCategoryId</a> <span class="keywordtype">id</span>)<span class="keyword"> override </span>{</div><div class="line">        <span class="keywordflow">return</span> <span class="keywordtype">id</span> == CustomPerfCounterCategory::GetId();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Accumulate counter deltas.</span></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#ae291c275f770fb50cd9e3d369ebca9e0">OnEvent</a>(</div><div class="line">        <span class="keyword">const</span> <a class="code" href="class_trace_thread_id.html">TraceThreadId</a>&amp;, <span class="keyword">const</span> <a class="code" href="class_tf_token.html">TfToken</a>&amp; k, <span class="keyword">const</span> <a class="code" href="class_trace_event.html">TraceEvent</a>&amp; e)<span class="keyword"> override </span>{</div><div class="line">        <span class="keywordflow">if</span> (e.<a class="code" href="class_trace_event.html#a7e96dfbae09090e2fa4430f70f9241ea">GetType</a>() == <a class="code" href="class_trace_event.html#afdf2c10d40c582d9884ac5635a374a34a5ddedfc9ca656d733f66c73f1174aa6e">TraceEvent::EventType::CounterDelta</a>) {</div><div class="line">            _counters[k] += e.<a class="code" href="class_trace_event.html#a33f83feda5ff45e1a18e700536ab42e6">GetCounterValue</a>();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a3c80c02c9ef4c21cc42fc923138704a8">OnBeginCollection</a>()<span class="keyword"> override </span>{}</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a6dfb37e0b38497f0e93dd9f3c5dc4bb3">OnEndCollection</a>()<span class="keyword"> override </span>{}</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a40662d18c54cefe17fce74f0d5e5b17d">OnBeginThread</a>(<span class="keyword">const</span> <a class="code" href="class_trace_thread_id.html">TraceThreadId</a>&amp;)<span class="keyword"> override </span>{}</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_trace_collection_1_1_visitor.html#a699411304ea70999cea0158fa076b613">OnEndThread</a>(<span class="keyword">const</span> <a class="code" href="class_trace_thread_id.html">TraceThreadId</a>&amp;)<span class="keyword"> override </span>{}</div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="comment">// This will be called by the TraceReporterBase::_Update() for each</span></div><div class="line">    <span class="comment">// TraceCollection received.</span></div><div class="line">    <span class="keywordtype">void</span> <a class="code" href="class_trace_reporter_base.html#a5271f5249704bb4c54f18a2a7a56e410">_ProcessCollection</a>(<span class="keyword">const</span> CollectionPtr&amp; collection)<span class="keyword"> override </span>{</div><div class="line">        <span class="comment">// Iterate over the TraceCollection using the TraceCollection::Visitor</span></div><div class="line">        <span class="comment">// interface.</span></div><div class="line">        collection-&gt;Iterate(*<span class="keyword">this</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    std::map&lt;TfToken, double&gt; _counters;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// Instrumented code</span></div><div class="line"><span class="keywordtype">void</span> Foo() </div><div class="line">{</div><div class="line">    CUSTOM_PERF_COUNTER(<span class="stringliteral">&quot;Foo Counter&quot;</span>,1);</div><div class="line">}</div><div class="line"></div><div class="line">std::atomic&lt;bool&gt; CustomPerfCounterCategory::_isEnabled(<span class="keyword">false</span>);</div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="comment">// Register a name with the id.</span></div><div class="line">    <a class="code" href="class_trace_category.html#a843883928c4ee80ce9d7e0143debaa18">TraceCategory::GetInstance</a>().<a class="code" href="class_trace_category.html#a8eb33c2cb2b06b0f3e3e8f4f8b0ff9e5">RegisterCategory</a>(</div><div class="line">        CustomPerfCounterCategory::GetId(), <span class="stringliteral">&quot;CustomPerfCounter&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Make sure an instance of the processor is available to receive notices.</span></div><div class="line">    CustomTraceEventProcessor eventProcessor(</div><div class="line">        <a class="code" href="class_trace_reporter_data_source_collector.html#a52a2a333a89f3e1e5314ef7052815b08">TraceReporterDataSourceCollector::New</a>());</div><div class="line"></div><div class="line">    <span class="comment">// Enable the recording of events for the category.</span></div><div class="line">    CustomPerfCounterCategory::Enable();</div><div class="line"></div><div class="line">    <span class="comment">// Call instrumented code.</span></div><div class="line">    Foo();</div><div class="line"></div><div class="line">    <span class="comment">// Disable the recording of events for the category.</span></div><div class="line">    CustomPerfCounterCategory::Disable();</div><div class="line"></div><div class="line">    <span class="comment">// Process the recorded events.</span></div><div class="line">    eventProcessor.Update();</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="trace_page_front.html">Trace: Performance tracking</a></li>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:06:57 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>