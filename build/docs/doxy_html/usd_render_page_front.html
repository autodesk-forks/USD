<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Universal Scene Description: UsdRender : USD Render Schema</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="usd_style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="https://openusd.org/images/USDIcon.ico"/>
<!-- ... other metadata & script includes ... -->
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript">
    DoxygenAwesomeFragmentCopyButton.init()
</script>
<!-- Add warning banner to top of page if current page isn't the release version -->
<script>
function AddWarningBanner() 
{
  // Get current URL
  const loc = new URL(location.href);
  // Look for URL of the format "<USD hostname>/<version|dev|release>/api/<file.html>"
  // NOTE: If versioning approach ever changes, this will need updating
  var apiIndex = loc.pathname.indexOf("/api/");
  if (apiIndex >= 0) {
    // Truncate "/api/..." off path to get preceding path and "/" index
    var truncString = loc.pathname.slice(0,apiIndex);
    // Get index of first "/" before "/api/"
    var preApiIndex = truncString.lastIndexOf("/");
    var verString = truncString.slice(preApiIndex + 1);
    // if the current page isn't the release version, add a warning banner 
    if (verString !== "release") {
      // Create alternate "release" URL for page
      // NOTE: This won't always be a valid URL, e.g. if dev release has a brand new page
      var relURL = loc.pathname.substring(0,preApiIndex) + "/release" + loc.pathname.substring(apiIndex);
      var banner = document.createElement("div");
      banner.className = "non_release_version_warning";
      if (verString === "dev") {
        banner.innerHTML = "This document is for a version of USD that is under development. See <a href='" + relURL + "'>this page</a> for the current release.";
      } else {
        // For now, we assume any other string is an older version string
        banner.innerHTML = "This document is for an older version of USD. See <a href='" + relURL + "'>this page</a> for the current release.";
      }
      document.body.insertBefore(banner,document.body.childNodes[0]);
    }
  }
} 
</script>
</head>
<body onload="AddWarningBanner()">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="USDLogoDocs.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('usd_render_page_front.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">UsdRender : USD Render Schema </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#UsdRenderStructureAndOrganization">Structure and Organization</a><ul><li class="level2"><a href="#UsdRenderConcepts">Concepts</a></li>
<li class="level2"><a href="#UsdRenderReadingSettings">Reading settings</a></li>
<li class="level2"><a href="#UsdRenderConventions">Conventions</a></li>
</ul>
</li>
<li class="level1"><a href="#UsdRenderHowSettingsAffectRendering">How settings affect rendering</a><ul><li class="level2"><a href="#UsdRenderCamera">Camera</a></li>
<li class="level2"><a href="#UsdRenderPixels">Pixels</a><ul><li class="level3"><a href="#UsdRenderAspectRatioPolicy">Aspect Ratio Policy</a></li>
<li class="level3"><a href="#UsdRenderCroppingTilingOverscan">Cropping, Tiling, Overscan</a></li>
<li class="level3"><a href="#UsdRenderRasterizationRule">Rasterization Rule</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#UsdRenderExtensinos">Extensions</a></li>
<li class="level1"><a href="#UsdRenderExampleUsage">Example Usage</a></li>
</ul>
</div>
<div class="textblock"><p>UsdRender provides schemas and behaviors for describing renders.</p>
<p><em>Rendering</em> refers to the process of generating images of a scene. In addition to images, rendering can also produce related byproducts such as depth maps, light probes, or point clouds. UsdRender provides primitives for configuring high-level aspects of the rendering process referred to collectively as <em>render settings</em>. An overview of the process follows.</p>
<h1><a class="anchor" id="UsdRenderStructureAndOrganization"></a>
Structure and Organization</h1>
<h2><a class="anchor" id="UsdRenderConcepts"></a>
Concepts</h2>
<ul>
<li><a class="el" href="class_usd_render_settings.html" title="A UsdRenderSettings prim specifies global settings for a render process, including an enumeration of ...">UsdRenderSettings</a> describes top-level settings required to invoke a renderer. It specifies one or more <em>products</em>, representing artifacts for the renderer to produce.</li>
<li><a class="el" href="class_usd_render_product.html" title="A UsdRenderProduct describes an image or other file-like artifact produced by a render.">UsdRenderProduct</a> describes a single product. It often corresponds to an image, but may instead be a point cloud or other artifact produced using techniques related to image rendering. Each product inherits the top-level settings, but may additionally specify product-specific settings or overrides.</li>
<li><a class="el" href="class_usd_render_settings_base.html" title="Abstract base class that defines render settings that can be specified on either a RenderSettings pri...">UsdRenderSettingsBase</a> represents the common settings shared by top-level settings and particular products.</li>
<li><a class="el" href="class_usd_render_var.html" title="A UsdRenderVar describes a custom data variable for a render to produce.">UsdRenderVar</a> describes a channel of computed output data, sometimes referred to as an <em>arbitrary output variable</em> or AOV. A product may contain multiple channels of data representing related values or variables sampled by a render process. The render var prim specifies details for how the renderer should produce the value. Examples of render variables include geometric measurements such as camera-space depth; quantities emitted by material shaders; light path expressions (LPE's); and quantities intrinsic to the renderer such as computation time per pixel.</li>
<li><a class="el" href="usd_render_2spec_8h.html#struct_usd_render_spec" title="A self-contained specification of render settings.">UsdRenderSpec</a> is a self-contained, evaluated specification of render settings, suitable for consumption by a backend.</li>
<li><a class="el" href="class_usd_render_pass.html" title="A RenderPass prim encapsulates the necessary information to generate multipass renders.">UsdRenderPass</a> bridges the rest of usdRender to the broader set of renderers in order to facilitate multiple invocations of different renderers, some of which may not describe a render in terms of <a class="el" href="class_usd_render_settings.html" title="A UsdRenderSettings prim specifies global settings for a render process, including an enumeration of ...">UsdRenderSettings</a>. In addition to organizing the different renders and processes (like denoising) that composite to produce a "final frame", <a class="el" href="class_usd_render_pass.html" title="A RenderPass prim encapsulates the necessary information to generate multipass renders.">UsdRenderPass</a> codifies the dependencies between passes, and that a single Pass generally represents not a single set of Products, but a sequence of temporally varying frames of outputs that depend on temporally varying inputs.</li>
</ul>
<h2><a class="anchor" id="UsdRenderReadingSettings"></a>
Reading settings</h2>
<p>A <a class="el" href="class_usd_stage.html" title="The outermost container for scene description, which owns and presents composed prims as a scenegraph...">UsdStage</a> may contain multiple <a class="el" href="class_usd_render_settings.html" title="A UsdRenderSettings prim specifies global settings for a render process, including an enumeration of ...">UsdRenderSettings</a> prims representing distinct groups of settings. A settings prim may be nominated as a useful default in layer metadata using the <code>renderSettingsPrimPath</code> field. Like all stage metadata, <code>renderSettingsPrimPath</code> can be authoredin a stage's root layer or session layer, but no other subLayers of the root layer. <a class="el" href="class_usd_render_settings.html#ac7147d405791c6e212fd18297ad0a5e6" title="Fetch and return stage &#39;s render settings, as indicated by root layer metadata.">UsdRenderSettings::GetStageRenderSettings()</a> will consult this metadata and return the associated prim.</p>
<p><a class="el" href="usd_render_2spec_8h.html#a38a6e0e21046ca986af3dd905fd4a79f" title="Computes the specification of the render settings.">UsdRenderComputeSpec()</a> will collect and evaluate <a class="el" href="class_usd_render_settings.html" title="A UsdRenderSettings prim specifies global settings for a render process, including an enumeration of ...">UsdRenderSettings</a> as a self-contained specification, <a class="el" href="usd_render_2spec_8h.html#struct_usd_render_spec" title="A self-contained specification of render settings.">UsdRenderSpec</a>.</p>
<h2><a class="anchor" id="UsdRenderConventions"></a>
Conventions</h2>
<p>Production toolsets may want to efficiently identify and operate on render settings without paying costs proportional to the size of the scene. To facilitate this, UsdRender follows a naming convention that all render settings in the scene must live under the path <code>&lt;/Render&gt;</code>. By requiring all render-related specification to be located under a unique root-level prim, we gain several advantages:</p>
<ul>
<li>We can leverage <a class="el" href="class_usd_stage.html#ade1d90d759a085022ba76ff910815320" title="Create a new stage and recursively compose prims defined within and referenced by the layer at filePa...">UsdStage::OpenMasked()</a> to compose just the rendering-related prims under <code>&lt;/Render&gt;</code>, making isolated access to this data fast, regardless of scene complexity.</li>
<li>This constrained organization facilitates sharing of rendering data within a production pipeline, as every "shot" can sublayer in sequence, production, and facility-level layers that each contain rendering data, and we are ensured consistent composition (and ease of discovery) of all the data.</li>
</ul>
<p>This does, in one sense, divorce a scene from its rendering specification, necessitating further management if you need to combine scenes. For example, should you want to reference one scene into another, you will need to reference in the root of the scene's geometry (<code>&lt;/World&gt;</code> in Pixar's pipeline), but then the scene's render specification gets left behind. The settings can be recaptured by separately referencing the scene's <code>&lt;/Render&gt;</code> prim onto the referencing scene's <code>&lt;/Render&gt;</code> prim, although some path corrections may be required. We think these situations arise infrequently enough that they do not outweigh the benefits of Render data always being in a known location. In practice, while we do organize and compose together scene geometry, and we also organize and compose together render settings, these are usually independent concerns that are not often tightly coupled.</p>
<h1><a class="anchor" id="UsdRenderHowSettingsAffectRendering"></a>
How settings affect rendering</h1>
<p><a class="anchor" id="UsdRender_Camera"></a></p>
<h2><a class="anchor" id="UsdRenderCamera"></a>
Camera</h2>
<p>An image is rendered by viewing a scene from a particular camera. <a class="el" href="class_usd_render_settings_base.html" title="Abstract base class that defines render settings that can be specified on either a RenderSettings pri...">UsdRenderSettingsBase</a> designates the camera via a relationship to a <a class="el" href="class_usd_geom_camera.html" title="Transformable camera.">UsdGeomCamera</a> prim.</p>
<p><a class="el" href="class_usd_geom_camera.html" title="Transformable camera.">UsdGeomCamera</a> attributes describe its <em>transform</em> and <em>projection</em>. The transform maps world coordinates to camera-relative view coordinates. The projection maps view coordinates to screen coordinates. The render settings for a <a class="el" href="class_usd_render_product.html" title="A UsdRenderProduct describes an image or other file-like artifact produced by a render.">UsdRenderProduct</a> map screen coordinates to its pixel coordinates.</p>
<p>The camera has additional attributes to bound the <em>frustum</em>, the volume of space viewed in the image. These attributes include the near and far clipping range, as well as optional additional clipping planes. The camera also specifies an <em>aperture</em>, which bounds the x and y axes of screen space. The aperture is specified in view coordinates using the same units as focal length (typically, millimeters). For a perspective projection, the aperture describes an axis-aligned rectangle in the plane sitting at the focal length in front of the camera origin:</p>
<div class="image">
<object type="image/svg+xml" data="aperture.svg">aperture.svg</object>
</div>
<p>For an orthographic projection, no reference plane is needed, and so the aperture simply bounds the x/y axes of view space. The aperture is still expresed in the same units as focal length in this case, although the focal length does not itself pertain to orthographic projection.</p>
<p>The projection of the aperture bounds to screen coordiantes is known as the <em>screen window</em>. UsdRenderSettings::ComputeDescription() computes screen window bounds.</p>
<p>The camera attributes determine the visual composition of the scene as an image, and as such represent creative choices distinct from the technical render settings used to configure image generation. This is why some attributes originate from the camera and others (such as pixel resolution) are expressed separately as render settings, and may vary per render product.</p>
<h2><a class="anchor" id="UsdRenderPixels"></a>
Pixels</h2>
<p>The screen aperture is sampled in a rectangular array of pixels known as the <em>raster image</em>. Typically, the full aperture is sampled. Render settings specify the <code>resolution</code> and <code>pixelAspectRatio</code> of the image pixel grid, which determines density and placement of pixel samples in the aperture.</p>
<div class="image">
<object type="image/svg+xml" data="pixelAspectRatio.svg">pixelAspectRatio.svg</object>
</div>
<p>The resolution and pixel aspect ratio together determine the total aspect ratio of the image. The pixelAspectRatio defaults to 1.0, indicating square pixels, however it is possible to use a different aspect ratio. The following is an example of a non-square pixel aspect ratio compensating for a non-square resolution, yielding a square image:</p>
<div class="image">
<object type="image/svg+xml" data="nonSquarePixels.svg">nonSquarePixels.svg</object>
</div>
<h3><a class="anchor" id="UsdRenderAspectRatioPolicy"></a>
Aspect Ratio Policy</h3>
<p>Because the camera aperture and image dimensions are specified independently, there may be a mismatch in their aspect ratio. For example, an interactive viewport may be resized to a ratio that does not match the camera, or a pipeline may be configured with a standard resolution that may not match a particular camera.</p>
<p>If the aspect ratio of the image does not match that of the aperture, an <code>aspectRatioConformPolicy</code> resolves the mismatch. The default policy expands the aperture as needed to fill the image &mdash; guaranteeing that the camera composition remains visible, but potentially revealing additonal areas of the scene. Other policy options allow for reducing the aperture, computing the effective pixelAspectRatio to exactly cover the aperture, or maintaining other constraints.</p>
<h3><a class="anchor" id="UsdRenderCroppingTilingOverscan"></a>
Cropping, Tiling, Overscan</h3>
<p>It can be useful to crop a render to isolate part of the scene, to render a large image as separate tiles, or to sample extra pixels beyond the aperture boundary to support post-processing kernels. This is controlled by the <em>data window</em>, which specifies the axis-aligned rectangular region in which to render data.</p>
<p>The data window is expressed in normalized device coordinates (NDC) using the <code>dataWindowNDC</code> attribute. It is normalized to the range of the policy-adjusted aperture. NDC coordinates allow the data window to be expressed in a resolution-independent form. (0,0) corresponds to the lower-left corner of the aperture, and (1,1) corresponds to the upper-right corner. The default data window matches the full aperture.</p>
<h3><a class="anchor" id="UsdRenderRasterizationRule"></a>
Rasterization Rule</h3>
<p>A pixel is included in the rendered image if its pixel center is contained within the requested data window. Pixel centers that fall exactly on the left or bottom (i.e. minimum coordinate) edge of the data window are included; pixel centers on the top or right edge (i.e. maximum coordinate) are excluded. This ensures that contiguous data window intervals produce contiguous pixel intervals, without overlap or gaps.</p>
<div class="image">
<object type="image/svg+xml" data="dataWindow.svg">dataWindow.svg</object>
</div>
<h1><a class="anchor" id="UsdRenderExtensinos"></a>
Extensions</h1>
<p>UsdRenderSettingsAPI is a base class API schema. USD schema libraries for particular renderers can subclass it with their own specific API schemas to encode settings specific to that renderer. Applications that import, inspect, or edit these can use the type hierarchy of API schemas to generically inspect the settings.</p>
<h1><a class="anchor" id="UsdRenderExampleUsage"></a>
Example Usage</h1>
<p>The following example is provided to illustrate the above concepts.</p>
<div class="fragment"><div class="line">#usda1.0</div><div class="line">(</div><div class="line">    renderSettingsPrimPath = &quot;/Render/PrimarySettings&quot;</div><div class="line">)</div><div class="line"></div><div class="line">def Scope &quot;Render&quot;</div><div class="line">{</div><div class="line">    def RenderSettings &quot;PrimarySettings&quot; {</div><div class="line">        rel products = &lt;/Render/PrimaryProduct&gt;</div><div class="line">        int2 resolution = (512, 512)</div><div class="line">    }</div><div class="line">    def RenderProduct &quot;PrimaryProduct&quot; {</div><div class="line">        rel camera = &lt;/World/main_cam&gt;</div><div class="line">        token productName = &quot;/scratch/tmp/render000009.exr&quot;</div><div class="line">        rel orderedVars = [</div><div class="line">            &lt;/Render/Vars/color&gt;,</div><div class="line">            &lt;/Render/Vars/alpha&gt;,</div><div class="line">            &lt;/Render/Vars/directDiffuse&gt;,</div><div class="line">            &lt;/Render/Vars/id&gt;</div><div class="line">        ]</div><div class="line">    }</div><div class="line">    def Scope &quot;Vars&quot;</div><div class="line">    {</div><div class="line">        def RenderVar &quot;color&quot; {</div><div class="line">            string sourceName = &quot;Ci&quot;</div><div class="line">        }</div><div class="line">        def RenderVar &quot;alpha&quot; {</div><div class="line">            token dataType = &quot;float&quot;</div><div class="line">            string sourceName = &quot;a&quot;</div><div class="line">        }</div><div class="line">        def RenderVar &quot;directDiffuse&quot; {</div><div class="line">            string sourceName = &quot;C&lt;RD&gt;[&lt;L.&gt;O]&quot;</div><div class="line">            token sourceType = &quot;lpe&quot;</div><div class="line">        }</div><div class="line">        def RenderVar &quot;id&quot; {</div><div class="line">            token dataType = &quot;int&quot;</div><div class="line">            string sourceName = &quot;id&quot;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    def Scope &quot;Passes&quot;</div><div class="line">    {</div><div class="line">        def RenderPass &quot;beauty&quot;{</div><div class="line">            token passType = &quot;prman&quot;</div><div class="line">            rel renderSource = &lt;Render/PrimarySettings&gt;</div><div class="line">            string[] command = [&quot;prman&quot;]</div><div class="line">        }</div><div class="line">        def RenderPass &quot;composite&quot;{</div><div class="line">            token passType = &quot;nuke&quot;</div><div class="line">            asset fileName = @composite.nk@</div><div class="line">            # this Nuke-namespaced property might come from a hypothetical </div><div class="line">            # Nuke-supplied API schema applied to this prim</div><div class="line">            string nuke:writeNode = &quot;WriteFinalComposite&quot;</div><div class="line">            rel renderSource = &lt;/Render/Passes/composite.nuke:writeNode&gt;</div><div class="line">            string[] command = [&quot;nuke&quot;, &quot;-x&quot;, &quot;-c&quot;, &quot;32G&quot;]</div><div class="line">            rel inputPasses = &lt;/Render/Passes/beauty&gt;</div><div class="line">        }        </div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.6-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">&copy; Copyright 2023, Pixar Animation Studios. Generated on Mon Nov 20 2023 16:06:57 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>